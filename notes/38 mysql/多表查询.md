# 多表查询

[SQL多表查询：SQL JOIN连接查询各种用法总结](https://blog.csdn.net/weixin_60528419/article/details/128701926)

### 数据表设计

- 一对一: 在从表里通过外键来关联主表的主键。

  比如一个用户只能有一个身份证, user 表叫主表，使用外键 user_id 引用它的 id 的 id_card 表是从表。

- 一对多：是通过在多的一方添加外键来引用一的一方的 id。
  比如一个部门有多个员工，department 表叫主表，使用外键 department_id 引用它的 id 的 employee 表是从表。设置级联方式为SET NULL，这样因为部门没了员工不一定也没了，可能还会分配到别的部门

- 多对多：通过中间表关联两个表。
  多对多不需要在双方保存彼此的外键，只要在中间表里维护这种关系即可。中间表的外键级联方式一定为 CASCADE，因为数据没了关系就没必要还留着了。
  多对多的表查询时 join 需要连接 3 个表来查询。

### 外键级联关系

主表数据 update 或者 delete 的时候，从表怎么办

- CASCADE：主表主键更新，从表关联记录的外键跟着更新，主表记录删除，从表关联记录删除
- SET NULL：主表主键更新或者主表记录删除，从表关联记录的外键设置为 null
- RESTRICT：只有没有从表的关联记录时，才允许删除主表记录或者更新主表记录的主键 id
- NO ACTION：同 RESTRICT，只是 sql 标准里分了 4 种，但 mysql 里 NO ACTION 等同于 RESTRICT

### 多表查询 join on

join 左边是左表, join 右边是右表, on 后面接关联方式

- inner join: 默认值, 只返回两个表有关联的记录
- left join: 额外返回没有关联记录的左表的记录
- right join: 额外返回没有关联记录的右表的记录

### 子查询

EXISTS：子查询返回结果，条件成立，反之不成立
NOT EXISTS：来查询所有没有员工的部门

子查询可以用在 select、insert、update、delete 语句

